<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Donut Chart - Interaction Fix</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #fafafa;
        }
        #vis {
            width: 100%;
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>

    <div id="vis"></div>

    <script type="text/javascript">
        var data = [
            {"Risque": "Effondrement", "Proportion (%)": 39},
            {"Risque": "Glissement", "Proportion (%)": 26},
            {"Risque": "Chute de blocs", "Proportion (%)": 23},
            {"Risque": "Érosion de berges", "Proportion (%)": 7},
            {"Risque": "Coulée", "Proportion (%)": 5}
        ];

        var spec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "width": 310,
            "height": 310,
            "data": {"values": data},
            "background": "transparent",
            "transform": [
                {"calculate": "datum['Proportion (%)'] + '%'", "as": "label_percent"}
            ],
            "encoding": {
                "theta": {"field": "Proportion (%)", "type": "quantitative", "stack": true},
                "color": {
                    "field": "Proportion (%)",
                    "type": "quantitative",
                    "scale": {"range": ["#D7CCC8", "#3E2723"]},
                    "legend": null
                },
                "order": {"field": "Proportion (%)", "sort": "descending"},
                "tooltip": [
                    {"field": "Risque", "type": "nominal", "title": "Type"},
                    {"field": "label_percent", "type": "nominal", "title": "Part"}
                ]
            },
            "layer": [
                {
                    "mark": {
                        "type": "arc", 
                        "outerRadius": 145, 
                        "innerRadius": 90, 
                        "stroke": "#fff", 
                        "strokeWidth": 1.5,
                        "cursor": "pointer",
                        "tooltip": true  /* FORCE L'INTERACTION SUR L'ARC */
                    }
                },
                {
                    "mark": {
                        "type": "text", 
                        "radius": 118, 
                        "fontSize": 14,
                        "fontWeight": "bold",
                        "interactive": false /* EMPECHE LE TEXTE DE BLOQUER LA SOURIS */
                    },
                    "encoding": {
                        "text": {"field": "label_percent"},
                        "color": {
                            "condition": {"test": "datum['Proportion (%)'] < 15", "value": "#3E2723"},
                            "value": "white"
                        }
                    }
                },
                {
                    "mark": {
                        "type": "text", 
                        "text": ["TOTAL", "100%"], 
                        "fontSize": 15, 
                        "fontWeight": "bold",
                        "interactive": false /* EMPECHE LE CENTRE DE BLOQUER LA SOURIS */
                    },
                    "encoding": {
                        "color": {"value": "#8D6E63"}
                    }
                }
            ],
            "config": {
                "view": {"stroke": "transparent"}
            }
        };

        // Utilisation de tooltip: true dans les options d'embed
        vegaEmbed('#vis', spec, {mode: "vega-lite", actions: false, tooltip: true}).catch(console.error);
    </script>
</body>
</html>
